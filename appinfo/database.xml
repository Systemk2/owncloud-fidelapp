<?xml version="1.0" encoding="ISO-8859-1" ?>
<database>
	<name>*dbname*</name>
	<create>true</create>
	<overwrite>false</overwrite>
	<charset>utf8</charset>
	<table>
		<name>*dbprefix*fidelapp_contacts</name>
		<declaration>
			<field>
				<name>id</name>
				<type>integer</type>
				<default>0</default>
				<notnull>true</notnull>
				<autoincrement>1</autoincrement>
				<length>4</length>
				<comments>Internal unique Id</comments>
			</field>
			<field>
				<name>user_id</name>
				<type>integer</type>
				<notnull>true</notnull>
				<length>4</length>
				<comments>Owncloud user</comments>
			</field>
			<field>
				<name>email</name>
				<type>text</type>
				<notnull>true</notnull>
				<length>512</length>
				<comments>e-Mail address of the receiver</comments>
			</field>
			<field>
				<name>password</name>
				<type>text</type>
				<length>512</length>
				<comments>The download password</comments>
			</field>
			<field>
				<name>contactsapp_id</name>
				<type>integer</type>
				<length>4</length>
				<comments>Optional reference to a receiver contact in the contacts
					app
				</comments>
			</field>
			<index>
				<name>primary_key_fidelapp_contacts</name>
				<primary>true</primary>
				<field>
					<name>id</name>
				</field>
			</index>
			<index>
				<name>constraint_unique_fidelapp_contacts</name>
				<unique>true</unique>
				<field>
					<name>user_id</name>
				</field>
				<field>
					<name>email</name>
				</field>
			</index>
		</declaration>
	</table>
	<table>
		<name>*dbprefix*fidelapp_shares</name>
		<declaration>
			<field>
				<name>id</name>
				<type>integer</type>
				<default>0</default>
				<notnull>true</notnull>
				<autoincrement>1</autoincrement>
				<length>4</length>
				<comments>Internal unique Id</comments>
			</field>
			<field>
				<name>contact_id</name>
				<type>integer</type>
				<length>4</length>
				<comments>Reference to a receiver contact in the fidelapp_contacts
					table
				</comments>
			</field>
			<field>
				<name>file_id</name>
				<type>integer</type>
				<notnull>true</notnull>
				<length>4</length>
				<comments>Reference to the id of the file that is shared</comments>
			</field>
			<field>
				<name>share_time</name>
				<type>timestamp</type>
				<default>CURRENT_TIMESTAMP</default>
				<notnull>true</notnull>
				<comments>When has the file been shared</comments>
			</field>
			<field>
				<name>download_time</name>
				<type>timestamp</type>
				<comments>When has the file been downloaded</comments>
			</field>
			<field>
				<name>share_notification</name>
				<type>integer</type>
				<notnull>true</notnull>
				<default>0</default>
				<length>1</length>
				<comments>Boolean indicating if the receiver has been notified that
					files are there to be downloaded
				</comments>
			</field>
			<field>
				<name>salt</name>
				<type>text</type>
				<length>14</length>
				<comments>The second part of the password, which is transmitted to
					the downloader only after checksum verfication.
				</comments>
			</field>
			<field>
				<name>notification_email</name>
				<type>text</type>
				<length>512</length>
				<comments>The notification e-mail for successful download</comments>
			</field>
			<field>
				<name>download_type</name>
				<notnull>true</notnull>
				<type>text</type>
				<length>32</length>
				<comments>BASIC or SECURE</comments>
			</field>
			<index>
				<name>primary_key_fidelapp_shares</name>
				<primary>true</primary>
				<field>
					<name>id</name>
				</field>
			</index>
			<index>
				<name>constraint_unique_fidelapp_shares</name>
				<unique>true</unique>
				<field>
					<name>contact_id</name>
				</field>
				<field>
					<name>file_id</name>
				</field>
			</index>
			<foreign>
				<name>foreign_key_fidelapp_contacts</name>
				<field>contact_id</field>
				<references>
					<table>*dbprefix*fidelapp_contacts</table>
					<field>id</field>
				</references>
				<ondelete>cascade</ondelete>
				<onupdate>cascade</onupdate>
			</foreign>
			<!-- Foreign keys to tables outside our schema do not work <foreign> <name>foreign_key_filecache</name> 
				<field>file_id</field> <references> <table>*dbprefix*filecache</table> <field>id</field> 
				</references> <ondelete>cascade</ondelete> <onupdate>cascade</onupdate> </foreign> -->
		</declaration>
	</table>
	<table>
		<name>*dbprefix*fidelapp_files</name>
		<declaration>
			<field>
				<name>id</name>
				<type>integer</type>
				<default>0</default>
				<notnull>true</notnull>
				<autoincrement>1</autoincrement>
				<length>4</length>
				<comments>Internal unique Id</comments>
			</field>
			<field>
				<name>file_id</name>
				<type>integer</type>
				<notnull>true</notnull>
				<length>4</length>
				<comments>Reference to the id of the file that is shared</comments>
			</field>
			<field>
				<name>checksum</name>
				<type>text</type>
				<length>32</length>
				<comments>The MD5 hash of the shared file</comments>
			</field>
			<field>
				<name>calculation_in_progress</name>
				<type>boolean</type>
				<length>1</length>
				<default>0</default>
				<notnull>true</notnull>
				<comments>Set to true, while calculation is in progress</comments>
			</field>

			<index>
				<name>primary_key_fidelapp_files</name>
				<primary>true</primary>
				<field>
					<name>id</name>
				</field>
			</index>
			<foreign>
				<name>foreign_key_shares</name>
				<field>file_id</field>
				<references>
					<table>*dbprefix*fidelapp_shares</table>
					<field>file_id</field>
				</references>
				<ondelete>cascade</ondelete>
				<onupdate>cascade</onupdate>
			</foreign>
		</declaration>
	</table>
</database>